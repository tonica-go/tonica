# Утилита командной строки (CLI)

Tonica поставляется с утилитой командной строки `tonica`, которая помогает быстро создавать проекты, генерировать шаблоны для сервисов и управлять локальным окружением.

## Установка

Для установки CLI выполните команду:

```bash
go install github.com/tonica-go/tonica@latest
```

Эта команда скомпилирует и установит бинарный файл `tonica` в ваш `$GOPATH/bin`. Убедитесь, что эта директория добавлена в системную переменную `PATH`.

```bash
export PATH=$PATH:$(go env GOPATH)/bin
```

## Команды

### `tonica init`

Инициализирует новую структуру проекта Tonica в текущей директории.

**Использование:**
```bash
tonica init --name=<project_name>
```

**Параметры:**
*   `--name` (обязательный): Имя вашего проекта. Используется для нейминга в файлах конфигурации.

**Пример:**
```bash
mkdir my-awesome-project && cd my-awesome-project
tonica init --name=my-awesome-project
```

Эта команда создаст базовую структуру папок (`proto`, `services`, `openapi`) и файлы конфигурации, такие как `buf.gen.yaml`, `buf.work.yaml`, `.golangci.yml` и `.env.example`.

### `tonica install`

Устанавливает все необходимые Go-инструменты для компиляции Protocol Buffers. Эта команда является удобной оберткой над `go install` для нескольких зависимостей.

**Использование:**
```bash
tonica install
```

**Что делает:**
Эта команда установит следующие плагины для `protoc`:
*   `protoc-gen-go`
*   `protoc-gen-go-grpc`
*   `protoc-gen-grpc-gateway`
*   `protoc-gen-openapiv2`

Рекомендуется запускать эту команду один раз после `tonica init`.

### `tonica proto`

Создает шаблонный `.proto` файл для нового gRPC сервиса.

**Использование:**
```bash
tonica proto --name=<service_name>
```

**Параметры:**
*   `--name` (обязательный): Имя нового сервиса (например, `users` или `payments`).

**Пример:**
```bash
tonica proto --name=billing
```

Команда создаст файл `proto/billing/v1/billing.proto` с базовым определением сервиса, методов и сообщений. **Важно:** эта команда *только* создает `.proto` файл. Для генерации Go-кода из этого файла используйте `buf generate`.

### `tonica wrap`

Генерирует Go-код (клиент и сервер) из существующего `.proto` файла. Эта команда полезна, если вы хотите интегрировать в Tonica уже существующий или сторонний proto-файл.

**Использование:**
```bash
tonica wrap --proto=<path_to_proto_file>
```

**Параметры:**
*   `--proto` (обязательный): Путь к `.proto` файлу.

**Пример:**
```bash
tonica wrap --proto=proto/billing/v1/billing.proto
```

Эта команда сгенерирует файл `billing_grpc.go` в той же директории, содержащий полезные константы и функции-обертки для регистрации сервиса в приложении Tonica.

### `tonica compose`

Запускает интерактивный генератор для создания файла `docker-compose.yml`.

**Использование:**
```bash
tonica compose
```

**Описание:**
Эта команда задаст вам серию вопросов о том, какие сервисы вы хотите включить в ваше локальное окружение для разработки. На основе ваших ответов будет сгенерирован готовый к использованию `docker-compose.yml`.

**Поддерживаемые сервисы:**
*   **PostgreSQL:** Реляционная база данных.
*   **Temporal:** Система для управления воркфлоу.
*   **Redpanda:** Kafka-совместимый брокер сообщений.
*   **Dragonfly:** Redis-совместимое хранилище в памяти.
*   **Mailhog:** Сервер для тестирования отправки email.
*   **Jaeger:** Система для распределенной трассировки.

## Типичный процесс разработки

Вот рекомендуемый порядок действий при создании нового проекта с нуля:

```bash
# 1. Создайте директорию для вашего проекта
mkdir my-app && cd my-app

# 2. Инициализируйте проект Tonica
tonica init --name=my-app

# 3. Инициализируйте Go-модуль
# Замените на ваш путь к репозиторию
go mod init github.com/my-org/my-app

# 4. Установите необходимые инструменты для кодогенерации
tonica install

# 5. Создайте свой первый сервис
tonica proto --name=greeter

# 6. Отредактируйте proto/greeter/v1/greeter.proto, чтобы определить ваши методы

# 7. Сгенерируйте Go-код из вашего .proto файла
buf generate

# 8. Установите сгенерированные зависимости
go mod tidy

# 9. Напишите реализацию вашего сервиса в директории 'services'

# 10. Зарегистрируйте сервис в main.go

# 11. Запустите приложение в режиме "all-in-one"
go run .
```